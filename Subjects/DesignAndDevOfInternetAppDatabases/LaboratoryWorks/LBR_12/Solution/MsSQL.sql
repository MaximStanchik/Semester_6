-- 1.	Создайте таблицу Report, содержащую два столбца – id и XML-столбец 
CREATE TABLE Report (
    id INT IDENTITY(1,1) PRIMARY KEY,
    ReportData XML
);

SELECT * FROM Report;

-- 2.	Создайте процедуру генерации XML. XML должен включать данные из как минимум 3 соединенных таблиц, различные промежуточные итоги и штамп времени
drop procedure GenerateOrdersXML;
CREATE OR ALTER PROCEDURE GenerateOrdersXML
AS
BEGIN
    SET NOCOUNT ON;

    SELECT (
        SELECT
            o.ID AS OrderID,
            c.ID AS ClientID,
            c.LOGIN AS ClientLogin,
            ci.FIRST_NAME AS ClientFirstName,
            ci.LAST_NAME AS ClientLastName,
            d.ID AS DriverID,
            d.LOGIN AS DriverLogin,
            o.STATUS AS OrderStatus,
            CONVERT(VARCHAR, o.CREATED_AT, 126) AS CreatedAt,
            o.TOTAL_WEIGHT AS TotalWeight,
            o.TOTAL_VOLUME AS TotalVolume
        FROM ORDERS o
        JOIN CLIENT c ON o.CLIENT_ID = c.ID
        JOIN CLIENT_INFO ci ON c.ID = ci.CLIENT_ID
        JOIN DRIVER d ON o.DRIVER_ID = d.ID
        FOR XML PATH('Order'), ROOT('Orders'), TYPE
    ) AS OrdersXML;
END;

EXEC GenerateOrdersXML;

-- 3.	Создайте процедуру вставки этого XML в таблицу Report
CREATE PROCEDURE InsertReportData
    @xmlData XML
AS
BEGIN
    SET NOCOUNT ON;

    INSERT INTO Report (ReportData)
    VALUES (@xmlData);
END;

DECLARE @xmlData XML;
SET @xmlData = '<Orders><Order><OrderID>3</OrderID><ClientID>1</ClientID><ClientLogin>funnyCat</ClientLogin><ClientFirstName>Bobby</ClientFirstName><ClientLastName>Funster</ClientLastName><DriverID>1</DriverID><DriverLogin>speedyTurtle</DriverLogin><OrderStatus>Delivered</OrderStatus><CreatedAt>2025-03-21T21:25:29.093</CreatedAt><TotalWeight>100.00</TotalWeight><TotalVolume>1.00</TotalVolume></Order><Order><OrderID>5</OrderID><ClientID>1</ClientID><ClientLogin>funnyCat</ClientLogin><ClientFirstName>Bobby</ClientFirstName><ClientLastName>Funster</ClientLastName><DriverID>1</DriverID><DriverLogin>speedyTurtle</DriverLogin><OrderStatus>Pending</OrderStatus><CreatedAt>2025-03-21T21:25:54.580</CreatedAt><TotalWeight>100.00</TotalWeight><TotalVolume>1.00</TotalVolume></Order><Order><OrderID>7</OrderID><ClientID>1</ClientID><ClientLogin>funnyCat</ClientLogin><ClientFirstName>Bobby</ClientFirstName><ClientLastName>Funster</ClientLastName><DriverID>1</DriverID><DriverLogin>speedyTurtle</DriverLogin><OrderStatus>Pending</OrderStatus><CreatedAt>2025-03-22T05:19:31.170</CreatedAt><TotalWeight>100.00</TotalWeight><TotalVolume>1.00</TotalVolume></Order><Order><OrderID>8</OrderID><ClientID>1</ClientID><ClientLogin>funnyCat</ClientLogin><ClientFirstName>Bobby</ClientFirstName><ClientLastName>Funster</ClientLastName><DriverID>1</DriverID><DriverLogin>speedyTurtle</DriverLogin><OrderStatus>Pending</OrderStatus><CreatedAt>2025-03-22T05:19:41.927</CreatedAt><TotalWeight>100.00</TotalWeight><TotalVolume>1.00</TotalVolume></Order><Order><OrderID>9</OrderID><ClientID>1</ClientID><ClientLogin>funnyCat</ClientLogin><ClientFirstName>Bobby</ClientFirstName><ClientLastName>Funster</ClientLastName><DriverID>1</DriverID><DriverLogin>speedyTurtle</DriverLogin><OrderStatus>Pending</OrderStatus><CreatedAt>2025-04-14T06:12:53.187</CreatedAt><TotalWeight>100.00</TotalWeight><TotalVolume>1.00</TotalVolume></Order><Order><OrderID>19</OrderID><ClientID>1</ClientID><ClientLogin>funnyCat</ClientLogin><ClientFirstName>Bobby</ClientFirstName><ClientLastName>Funster</ClientLastName><DriverID>1</DriverID><DriverLogin>speedyTurtle</DriverLogin><OrderStatus>Pending</OrderStatus><CreatedAt>2025-04-14T06:12:53.187</CreatedAt><TotalWeight>100.00</TotalWeight><TotalVolume>1.00</TotalVolume></Order><Order><OrderID>29</OrderID><ClientID>1</ClientID><ClientLogin>funnyCat</ClientLogin><ClientFirstName>Bobby</ClientFirstName><ClientLastName>Funster</ClientLastName><DriverID>1</DriverID><DriverLogin>speedyTurtle</DriverLogin><OrderStatus>Pending</OrderStatus><CreatedAt>2025-04-14T06:12:53.187</CreatedAt><TotalWeight>100.00</TotalWeight><TotalVolume>1.00</TotalVolume></Order><Order><OrderID>39</OrderID><ClientID>1</ClientID><ClientLogin>funnyCat</ClientLogin><ClientFirstName>Bobby</ClientFirstName><ClientLastName>Funster</ClientLastName><DriverID>1</DriverID><DriverLogin>speedyTurtle</DriverLogin><OrderStatus>Pending</OrderStatus><CreatedAt>2025-04-14T06:12:53.187</CreatedAt><TotalWeight>100.00</TotalWeight><TotalVolume>1.00</TotalVolume></Order><Order><OrderID>4</OrderID><ClientID>2</ClientID><ClientLogin>sillyDog</ClientLogin><ClientFirstName>Daisy</ClientFirstName><ClientLastName>Wag</ClientLastName><DriverID>2</DriverID><DriverLogin>ninjaFrog</DriverLogin><OrderStatus>Delivered</OrderStatus><CreatedAt>2025-03-21T21:25:29.100</CreatedAt><TotalWeight>200.00</TotalWeight><TotalVolume>3.00</TotalVolume></Order><Order><OrderID>6</OrderID><ClientID>2</ClientID><ClientLogin>sillyDog</ClientLogin><ClientFirstName>Daisy</ClientFirstName><ClientLastName>Wag</ClientLastName><DriverID>2</DriverID><DriverLogin>ninjaFrog</DriverLogin><OrderStatus>In Transit</OrderStatus><CreatedAt>2025-03-21T21:25:54.583</CreatedAt><TotalWeight>200.00</TotalWeight><TotalVolume>3.00</TotalVolume></Order><Order><OrderID>10</OrderID><ClientID>2</ClientID><ClientLogin>sillyDog</ClientLogin><ClientFirstName>Daisy</ClientFirstName><ClientLastName>Wag</ClientLastName><DriverID>2</DriverID><DriverLogin>ninjaFrog</DriverLogin><OrderStatus>In Transit</OrderStatus><CreatedAt>2025-04-14T06:12:53.187</CreatedAt><TotalWeight>200.00</TotalWeight><TotalVolume>3.00</TotalVolume></Order><Order><OrderID>20</OrderID><ClientID>2</ClientID><ClientLogin>sillyDog</ClientLogin><ClientFirstName>Daisy</ClientFirstName><ClientLastName>Wag</ClientLastName><DriverID>2</DriverID><DriverLogin>ninjaFrog</DriverLogin><OrderStatus>In Transit</OrderStatus><CreatedAt>2025-04-14T06:12:53.187</CreatedAt><TotalWeight>200.00</TotalWeight><TotalVolume>3.00</TotalVolume></Order><Order><OrderID>30</OrderID><ClientID>2</ClientID><ClientLogin>sillyDog</ClientLogin><ClientFirstName>Daisy</ClientFirstName><ClientLastName>Wag</ClientLastName><DriverID>2</DriverID><DriverLogin>ninjaFrog</DriverLogin><OrderStatus>In Transit</OrderStatus><CreatedAt>2025-04-14T06:12:53.187</CreatedAt><TotalWeight>200.00</TotalWeight><TotalVolume>3.00</TotalVolume></Order><Order><OrderID>40</OrderID><ClientID>2</ClientID><ClientLogin>sillyDog</ClientLogin><ClientFirstName>Daisy</ClientFirstName><ClientLastName>Wag</ClientLastName><DriverID>2</DriverID><DriverLogin>ninjaFrog</DriverLogin><OrderStatus>In Transit</OrderStatus><CreatedAt>2025-04-14T06:12:53.187</CreatedAt><TotalWeight>200.00</TotalWeight><TotalVolume>3.00</TotalVolume></Order><Order><OrderID>11</OrderID><ClientID>3</ClientID><ClientLogin>happyPenguin</ClientLogin><ClientFirstName>Penny</ClientFirstName><ClientLastName>Slide</ClientLastName><DriverID>3</DriverID><DriverLogin>crazyKoala</DriverLogin><OrderStatus>Delivered</OrderStatus><CreatedAt>2025-04-14T06:12:53.187</CreatedAt><TotalWeight>150.00</TotalWeight><TotalVolume>2.50</TotalVolume></Order><Order><OrderID>21</OrderID><ClientID>3</ClientID><ClientLogin>happyPenguin</ClientLogin><ClientFirstName>Penny</ClientFirstName><ClientLastName>Slide</ClientLastName><DriverID>3</DriverID><DriverLogin>crazyKoala</DriverLogin><OrderStatus>Delivered</OrderStatus><CreatedAt>2025-04-14T06:12:53.187</CreatedAt><TotalWeight>150.00</TotalWeight><TotalVolume>2.50</TotalVolume></Order><Order><OrderID>31</OrderID><ClientID>3</ClientID><ClientLogin>happyPenguin</ClientLogin><ClientFirstName>Penny</ClientFirstName><ClientLastName>Slide</ClientLastName><DriverID>3</DriverID><DriverLogin>crazyKoala</DriverLogin><OrderStatus>Delivered</OrderStatus><CreatedAt>2025-04-14T06:12:53.187</CreatedAt><TotalWeight>150.00</TotalWeight><TotalVolume>2.50</TotalVolume></Order><Order><OrderID>41</OrderID><ClientID>3</ClientID><ClientLogin>happyPenguin</ClientLogin><ClientFirstName>Penny</ClientFirstName><ClientLastName>Slide</ClientLastName><DriverID>3</DriverID><DriverLogin>crazyKoala</DriverLogin><OrderStatus>Delivered</OrderStatus><CreatedAt>2025-04-14T06:12:53.187</CreatedAt><TotalWeight>150.00</TotalWeight><TotalVolume>2.50</TotalVolume></Order><Order><OrderID>12</OrderID><ClientID>4</ClientID><ClientLogin>quirkyOstrich</ClientLogin><ClientFirstName>Ollie</ClientFirstName><ClientLastName>Run</ClientLastName><DriverID>4</DriverID><DriverLogin>sneakyFox</DriverLogin><OrderStatus>Cancelled</OrderStatus><CreatedAt>2025-04-14T06:12:53.187</CreatedAt><TotalWeight>300.00</TotalWeight><TotalVolume>4.00</TotalVolume></Order><Order><OrderID>22</OrderID><ClientID>4</ClientID><ClientLogin>quirkyOstrich</ClientLogin><ClientFirstName>Ollie</ClientFirstName><ClientLastName>Run</ClientLastName><DriverID>4</DriverID><DriverLogin>sneakyFox</DriverLogin><OrderStatus>Cancelled</OrderStatus><CreatedAt>2025-04-14T06:12:53.187</CreatedAt><TotalWeight>300.00</TotalWeight><TotalVolume>4.00</TotalVolume></Order><Order><OrderID>32</OrderID><ClientID>4</ClientID><ClientLogin>quirkyOstrich</ClientLogin><ClientFirstName>Ollie</ClientFirstName><ClientLastName>Run</ClientLastName><DriverID>4</DriverID><DriverLogin>sneakyFox</DriverLogin><OrderStatus>Cancelled</OrderStatus><CreatedAt>2025-04-14T06:12:53.187</CreatedAt><TotalWeight>300.00</TotalWeight><TotalVolume>4.00</TotalVolume></Order><Order><OrderID>42</OrderID><ClientID>4</ClientID><ClientLogin>quirkyOstrich</ClientLogin><ClientFirstName>Ollie</ClientFirstName><ClientLastName>Run</ClientLastName><DriverID>4</DriverID><DriverLogin>sneakyFox</DriverLogin><OrderStatus>Cancelled</OrderStatus><CreatedAt>2025-04-14T06:12:53.187</CreatedAt><TotalWeight>300.00</TotalWeight><TotalVolume>4.00</TotalVolume></Order><Order><OrderID>13</OrderID><ClientID>5</ClientID><ClientLogin>cheerfulLlama</ClientLogin><ClientFirstName>Lenny</ClientFirstName><ClientLastName>Spit</ClientLastName><DriverID>5</DriverID><DriverLogin>jumpyKangaroo</DriverLogin><OrderStatus>On Hold</OrderStatus><CreatedAt>2025-04-14T06:12:53.187</CreatedAt><TotalWeight>500.00</TotalWeight><TotalVolume>5.00</TotalVolume></Order><Order><OrderID>23</OrderID><ClientID>5</ClientID><ClientLogin>cheerfulLlama</ClientLogin><ClientFirstName>Lenny</ClientFirstName><ClientLastName>Spit</ClientLastName><DriverID>5</DriverID><DriverLogin>jumpyKangaroo</DriverLogin><OrderStatus>On Hold</OrderStatus><CreatedAt>2025-04-14T06:12:53.187</CreatedAt><TotalWeight>500.00</TotalWeight><TotalVolume>5.00</TotalVolume></Order><Order><OrderID>33</OrderID><ClientID>5</ClientID><ClientLogin>cheerfulLlama</ClientLogin><ClientFirstName>Lenny</ClientFirstName><ClientLastName>Spit</ClientLastName><DriverID>5</DriverID><DriverLogin>jumpyKangaroo</DriverLogin><OrderStatus>On Hold</OrderStatus><CreatedAt>2025-04-14T06:12:53.187</CreatedAt><TotalWeight>500.00</TotalWeight><TotalVolume>5.00</TotalVolume></Order><Order><OrderID>43</OrderID><ClientID>5</ClientID><ClientLogin>cheerfulLlama</ClientLogin><ClientFirstName>Lenny</ClientFirstName><ClientLastName>Spit</ClientLastName><DriverID>5</DriverID><DriverLogin>jumpyKangaroo</DriverLogin><OrderStatus>On Hold</OrderStatus><CreatedAt>2025-04-14T06:12:53.187</CreatedAt><TotalWeight>500.00</TotalWeight><TotalVolume>5.00</TotalVolume></Order><Order><OrderID>14</OrderID><ClientID>6</ClientID><ClientLogin>wittySquirrel</ClientLogin><ClientFirstName>Nina</ClientFirstName><ClientLastName>Nutty</ClientLastName><DriverID>6</DriverID><DriverLogin>charmingParrot</DriverLogin><OrderStatus>Completed</OrderStatus><CreatedAt>2025-04-14T06:12:53.187</CreatedAt><TotalWeight>100.00</TotalWeight><TotalVolume>1.00</TotalVolume></Order><Order><OrderID>24</OrderID><ClientID>6</ClientID><ClientLogin>wittySquirrel</ClientLogin><ClientFirstName>Nina</ClientFirstName><ClientLastName>Nutty</ClientLastName><DriverID>6</DriverID><DriverLogin>charmingParrot</DriverLogin><OrderStatus>Completed</OrderStatus><CreatedAt>2025-04-14T06:12:53.187</CreatedAt><TotalWeight>100.00</TotalWeight><TotalVolume>1.00</TotalVolume></Order><Order><OrderID>34</OrderID><ClientID>6</ClientID><ClientLogin>wittySquirrel</ClientLogin><ClientFirstName>Nina</ClientFirstName><ClientLastName>Nutty</ClientLastName><DriverID>6</DriverID><DriverLogin>charmingParrot</DriverLogin><OrderStatus>Completed</OrderStatus><CreatedAt>2025-04-14T06:12:53.187</CreatedAt><TotalWeight>100.00</TotalWeight><TotalVolume>1.00</TotalVolume></Order><Order><OrderID>44</OrderID><ClientID>6</ClientID><ClientLogin>wittySquirrel</ClientLogin><ClientFirstName>Nina</ClientFirstName><ClientLastName>Nutty</ClientLastName><DriverID>6</DriverID><DriverLogin>charmingParrot</DriverLogin><OrderStatus>Completed</OrderStatus><CreatedAt>2025-04-14T06:12:53.187</CreatedAt><TotalWeight>100.00</TotalWeight><TotalVolume>1.00</TotalVolume></Order><Order><OrderID>15</OrderID><ClientID>7</ClientID><ClientLogin>jollyGiraffe</ClientLogin><ClientFirstName>Gary</ClientFirstName><ClientLastName>Tall</ClientLastName><DriverID>7</DriverID><DriverLogin>joyfulPanda</DriverLogin><OrderStatus>Returned</OrderStatus><CreatedAt>2025-04-14T06:12:53.187</CreatedAt><TotalWeight>200.00</TotalWeight><TotalVolume>3.00</TotalVolume></Order><Order><OrderID>25</OrderID><ClientID>7</ClientID><ClientLogin>jollyGiraffe</ClientLogin><ClientFirstName>Gary</ClientFirstName><ClientLastName>Tall</ClientLastName><DriverID>7</DriverID><DriverLogin>joyfulPanda</DriverLogin><OrderStatus>Returned</OrderStatus><CreatedAt>2025-04-14T06:12:53.187</CreatedAt><TotalWeight>200.00</TotalWeight><TotalVolume>3.00</TotalVolume></Order><Order><OrderID>35</OrderID><ClientID>7</ClientID><ClientLogin>jollyGiraffe</ClientLogin><ClientFirstName>Gary</ClientFirstName><ClientLastName>Tall</ClientLastName><DriverID>7</DriverID><DriverLogin>joyfulPanda</DriverLogin><OrderStatus>Returned</OrderStatus><CreatedAt>2025-04-14T06:12:53.187</CreatedAt><TotalWeight>200.00</TotalWeight><TotalVolume>3.00</TotalVolume></Order><Order><OrderID>45</OrderID><ClientID>7</ClientID><ClientLogin>jollyGiraffe</ClientLogin><ClientFirstName>Gary</ClientFirstName><ClientLastName>Tall</ClientLastName><DriverID>7</DriverID><DriverLogin>joyfulPanda</DriverLogin><OrderStatus>Returned</OrderStatus><CreatedAt>2025-04-14T06:12:53.187</CreatedAt><TotalWeight>200.00</TotalWeight><TotalVolume>3.00</TotalVolume></Order><Order><OrderID>16</OrderID><ClientID>8</ClientID><ClientLogin>merryHippo</ClientLogin><ClientFirstName>Marty</ClientFirstName><ClientLastName>Water</ClientLastName><DriverID>8</DriverID><DriverLogin>quirkyRaccoon</DriverLogin><OrderStatus>Lost</OrderStatus><CreatedAt>2025-04-14T06:12:53.187</CreatedAt><TotalWeight>150.00</TotalWeight><TotalVolume>2.50</TotalVolume></Order><Order><OrderID>26</OrderID><ClientID>8</ClientID><ClientLogin>merryHippo</ClientLogin><ClientFirstName>Marty</ClientFirstName><ClientLastName>Water</ClientLastName><DriverID>8</DriverID><DriverLogin>quirkyRaccoon</DriverLogin><OrderStatus>Lost</OrderStatus><CreatedAt>2025-04-14T06:12:53.187</CreatedAt><TotalWeight>150.00</TotalWeight><TotalVolume>2.50</TotalVolume></Order><Order><OrderID>36</OrderID><ClientID>8</ClientID><ClientLogin>merryHippo</ClientLogin><ClientFirstName>Marty</ClientFirstName><ClientLastName>Water</ClientLastName><DriverID>8</DriverID><DriverLogin>quirkyRaccoon</DriverLogin><OrderStatus>Lost</OrderStatus><CreatedAt>2025-04-14T06:12:53.187</CreatedAt><TotalWeight>150.00</TotalWeight><TotalVolume>2.50</TotalVolume></Order><Order><OrderID>46</OrderID><ClientID>8</ClientID><ClientLogin>merryHippo</ClientLogin><ClientFirstName>Marty</ClientFirstName><ClientLastName>Water</ClientLastName><DriverID>8</DriverID><DriverLogin>quirkyRaccoon</DriverLogin><OrderStatus>Lost</OrderStatus><CreatedAt>2025-04-14T06:12:53.187</CreatedAt><TotalWeight>150.00</TotalWeight><TotalVolume>2.50</TotalVolume></Order><Order><OrderID>17</OrderID><ClientID>9</ClientID><ClientLogin>playfulOtter</ClientLogin><ClientFirstName>Otto</ClientFirstName><ClientLastName>Swim</ClientLastName><DriverID>9</DriverID><DriverLogin>spunkyFerret</DriverLogin><OrderStatus>Awaiting Pickup</OrderStatus><CreatedAt>2025-04-14T06:12:53.187</CreatedAt><TotalWeight>300.00</TotalWeight><TotalVolume>4.00</TotalVolume></Order><Order><OrderID>27</OrderID><ClientID>9</ClientID><ClientLogin>playfulOtter</ClientLogin><ClientFirstName>Otto</ClientFirstName><ClientLastName>Swim</ClientLastName><DriverID>9</DriverID><DriverLogin>spunkyFerret</DriverLogin><OrderStatus>Awaiting Pickup</OrderStatus><CreatedAt>2025-04-14T06:12:53.187</CreatedAt><TotalWeight>300.00</TotalWeight><TotalVolume>4.00</TotalVolume></Order><Order><OrderID>37</OrderID><ClientID>9</ClientID><ClientLogin>playfulOtter</ClientLogin><ClientFirstName>Otto</ClientFirstName><ClientLastName>Swim</ClientLastName><DriverID>9</DriverID><DriverLogin>spunkyFerret</DriverLogin><OrderStatus>Awaiting Pickup</OrderStatus><CreatedAt>2025-04-14T06:12:53.187</CreatedAt><TotalWeight>300.00</TotalWeight><TotalVolume>4.00</TotalVolume></Order><Order><OrderID>47</OrderID><ClientID>9</ClientID><ClientLogin>playfulOtter</ClientLogin><ClientFirstName>Otto</ClientFirstName><ClientLastName>Swim</ClientLastName><DriverID>9</DriverID><DriverLogin>spunkyFerret</DriverLogin><OrderStatus>Awaiting Pickup</OrderStatus><CreatedAt>2025-04-14T06:12:53.187</CreatedAt><TotalWeight>300.00</TotalWeight><TotalVolume>4.00</TotalVolume></Order><Order><OrderID>18</OrderID><ClientID>10</ClientID><ClientLogin>zanyZebra</ClientLogin><ClientFirstName>Zara</ClientFirstName><ClientLastName>Stripe</ClientLastName><DriverID>10</DriverID><DriverLogin>dapperPenguin</DriverLogin><OrderStatus>Exception</OrderStatus><CreatedAt>2025-04-14T06:12:53.187</CreatedAt><TotalWeight>500.00</TotalWeight><TotalVolume>5.00</TotalVolume></Order><Order><OrderID>28</OrderID><ClientID>10</ClientID><ClientLogin>zanyZebra</ClientLogin><ClientFirstName>Zara</ClientFirstName><ClientLastName>Stripe</ClientLastName><DriverID>10</DriverID><DriverLogin>dapperPenguin</DriverLogin><OrderStatus>Exception</OrderStatus><CreatedAt>2025-04-14T06:12:53.187</CreatedAt><TotalWeight>500.00</TotalWeight><TotalVolume>5.00</TotalVolume></Order><Order><OrderID>38</OrderID><ClientID>10</ClientID><ClientLogin>zanyZebra</ClientLogin><ClientFirstName>Zara</ClientFirstName><ClientLastName>Stripe</ClientLastName><DriverID>10</DriverID><DriverLogin>dapperPenguin</DriverLogin><OrderStatus>Exception</OrderStatus><CreatedAt>2025-04-14T06:12:53.187</CreatedAt><TotalWeight>500.00</TotalWeight><TotalVolume>5.00</TotalVolume></Order><Order><OrderID>48</OrderID><ClientID>10</ClientID><ClientLogin>zanyZebra</ClientLogin><ClientFirstName>Zara</ClientFirstName><ClientLastName>Stripe</ClientLastName><DriverID>10</DriverID><DriverLogin>dapperPenguin</DriverLogin><OrderStatus>Exception</OrderStatus><CreatedAt>2025-04-14T06:12:53.187</CreatedAt><TotalWeight>500.00</TotalWeight><TotalVolume>5.00</TotalVolume></Order></Orders>';
EXEC InsertReportData @xmlData;

-- 4.	Создайте индекс над XML-столбцом в таблице Report.
CREATE PRIMARY XML INDEX primary_idx_xmlIndex ----! + посмотреть план запроса
ON Report (ReportData);

-- 5.	Создайте процедуру извлечения значений элементов и/или атрибутов из XML -столбца в таблице Report (параметр – значение атрибута или элемента)
CREATE PROCEDURE getInfoFromXml
    @ElementName NVARCHAR(255)
AS
BEGIN
    SET NOCOUNT ON;

    DECLARE @sql NVARCHAR(MAX);
    SET @sql = 'SELECT ReportData.value(''(/Orders/Order/' + @ElementName + ')[1]'', ''NVARCHAR(255)'') AS ExtractedValue FROM Report;';

    EXEC sp_executesql @sql;
END;

drop procedure getInfoFromXml;

EXEC getInfoFromXml 'ClientFirstName'; 

SELECT 
    OrderData.value('(OrderID)[1]', 'INT') AS OrderID,
    OrderData.value('(OrderStatus)[1]', 'VARCHAR(50)') AS Status
FROM 
    Report WITH (FORCESEEK)
CROSS APPLY 
    ReportData.nodes('/Orders/Order') AS OrderData(OrderData);


	SELECT * 
FROM sys.xml_indexes 
WHERE name = 'primary_idx_xmlIndex';

